var snowStorm=(function(g,h){this.autoStart=true;this.excludeMobile=false;this.flakesMax=128;this.flakesMaxActive=64;this.animationInterval=33;this.useGPU=true;this.className=null;this.excludeMobile=false;this.flakeBottom=null;this.followMouse=true;this.snowColor='#fff';this.snowCharacter='&bull;';this.snowStick=true;this.targetElement=null;this.useMeltEffect=true;this.useTwinkleEffect=false;this.usePositionFixed=false;this.usePixelPosition=false;this.freezeOnBlur=true;this.flakeLeftOffset=0;this.flakeRightOffset=0;this.flakeWidth=8;this.flakeHeight=8;this.vMaxX=5;this.vMaxY=4;this.zIndex=0;var k=this,features,isIE=navigator.userAgent.match(/msie/i),isIE6=navigator.userAgent.match(/msie 6/i),isMobile=navigator.userAgent.match(/mobile|opera m(ob|in)/i),isBackCompatIE=(isIE&&h.compatMode==='BackCompat'),noFixed=(isBackCompatIE||isIE6),screenX=null,screenX2=null,screenY=null,scrollY=null,docHeight=null,vRndX=null,vRndY=null,windOffset=1,windMultiplier=2,flakeTypes=6,fixedForEverything=false,targetElementIsRelative=false,opacitySupported=(function(){try{h.createElement('div').style.opacity='0.5'}catch(e){return false}return true}()),didInit=false,docFrag=h.createDocumentFragment();features=(function(){var c;function timeoutShim(a){g.setTimeout(a,1000/(k.animationInterval||20))}var d=(g.requestAnimationFrame||g.webkitRequestAnimationFrame||g.mozRequestAnimationFrame||g.oRequestAnimationFrame||g.msRequestAnimationFrame||timeoutShim);c=d?function(){return d.apply(g,arguments)}:null;var e;e=h.createElement('div');function has(a){var b=e.style[a];return(b!==undefined?a:null)}var f={transform:{ie:has('-ms-transform'),moz:has('MozTransform'),opera:has('OTransform'),webkit:has('webkitTransform'),w3:has('transform'),prop:null},getAnimationFrame:c};f.transform.prop=(f.transform.w3||f.transform.moz||f.transform.webkit||f.transform.ie||f.transform.opera);e=null;return f}());this.timer=null;this.flakes=[];this.disabled=false;this.active=false;this.meltFrameCount=20;this.meltFrames=[];this.setXY=function(o,x,y){if(!o){return false}if(k.usePixelPosition||targetElementIsRelative){o.style.left=(x-k.flakeWidth)+'px';o.style.top=(y-k.flakeHeight)+'px'}else if(noFixed){o.style.right=(100-(x/screenX*100))+'%';o.style.top=(Math.min(y,docHeight-k.flakeHeight))+'px'}else{if(!k.flakeBottom){o.style.right=(100-(x/screenX*100))+'%';o.style.bottom=(100-(y/screenY*100))+'%'}else{o.style.right=(100-(x/screenX*100))+'%';o.style.top=(Math.min(y,docHeight-k.flakeHeight))+'px'}}};this.events=(function(){var d=(!g.addEventListener&&g.attachEvent),slice=Array.prototype.slice,evt={add:(d?'attachEvent':'addEventListener'),remove:(d?'detachEvent':'removeEventListener')};function getArgs(a){var b=slice.call(a),len=b.length;if(d){b[1]='on'+b[1];if(len>3){b.pop()}}else if(len===3){b.push(false)}return b}function apply(a,b){var c=a.shift(),method=[evt[b]];if(d){c[method](a[0],a[1])}else{c[method].apply(c,a)}}function addEvent(){apply(getArgs(arguments),'add')}function removeEvent(){apply(getArgs(arguments),'remove')}return{add:addEvent,remove:removeEvent}}());function rnd(n,a){if(isNaN(a)){a=0}return(Math.random()*n)+a}function plusMinus(n){return(parseInt(rnd(2),10)===1?n*-1:n)}this.randomizeWind=function(){var i;vRndX=plusMinus(rnd(k.vMaxX,0.2));vRndY=rnd(k.vMaxY,0.2);if(this.flakes){for(i=0;i<this.flakes.length;i++){if(this.flakes[i].active){this.flakes[i].setVelocities()}}}};this.scrollHandler=function(){var i;scrollY=(k.flakeBottom?0:parseInt(g.scrollY||h.documentElement.scrollTop||(noFixed?h.body.scrollTop:0),10));if(isNaN(scrollY)){scrollY=0}if(!fixedForEverything&&!k.flakeBottom&&k.flakes){for(i=0;i<k.flakes.length;i++){if(k.flakes[i].active===0){k.flakes[i].stick()}}}};this.resizeHandler=function(){if(g.innerWidth||g.innerHeight){screenX=g.innerWidth-16-k.flakeRightOffset;screenY=(k.flakeBottom||g.innerHeight)}else{screenX=(h.documentElement.clientWidth||h.body.clientWidth||h.body.scrollWidth)-(!isIE?8:0)-k.flakeRightOffset;screenY=k.flakeBottom||h.documentElement.clientHeight||h.body.clientHeight||h.body.scrollHeight}docHeight=h.body.offsetHeight;screenX2=parseInt(screenX/2,10)};this.resizeHandlerAlt=function(){screenX=k.targetElement.offsetWidth-k.flakeRightOffset;screenY=k.flakeBottom||k.targetElement.offsetHeight;screenX2=parseInt(screenX/2,10);docHeight=h.body.offsetHeight};this.freeze=function(){if(!k.disabled){k.disabled=1}else{return false}k.timer=null};this.resume=function(){if(k.disabled){k.disabled=0}else{return false}k.timerInit()};this.toggleSnow=function(){if(!k.flakes.length){k.start()}else{k.active=!k.active;if(k.active){k.show();k.resume()}else{k.stop();k.freeze()}}};this.stop=function(){var i;this.freeze();for(i=0;i<this.flakes.length;i++){this.flakes[i].o.style.display='none'}k.events.remove(g,'scroll',k.scrollHandler);k.events.remove(g,'resize',k.resizeHandler);if(k.freezeOnBlur){if(isIE){k.events.remove(h,'focusout',k.freeze);k.events.remove(h,'focusin',k.resume)}else{k.events.remove(g,'blur',k.freeze);k.events.remove(g,'focus',k.resume)}}};this.show=function(){var i;for(i=0;i<this.flakes.length;i++){this.flakes[i].o.style.display='block'}};this.SnowFlake=function(b,x,y){var s=this;this.type=b;this.x=x||parseInt(rnd(screenX-20),10);this.y=(!isNaN(y)?y:-rnd(screenY)-12);this.vX=null;this.vY=null;this.vAmpTypes=[1,1.2,1.4,1.6,1.8];this.vAmp=this.vAmpTypes[this.type]||1;this.melting=false;this.meltFrameCount=k.meltFrameCount;this.meltFrames=k.meltFrames;this.meltFrame=0;this.twinkleFrame=0;this.active=1;this.fontSize=(10+(this.type/5)*10);this.o=h.createElement('div');this.o.innerHTML=k.snowCharacter;if(k.className){this.o.setAttribute('class',k.className)}this.o.style.color=k.snowColor;this.o.style.position=(fixedForEverything?'fixed':'absolute');if(k.useGPU&&features.transform.prop){this.o.style[features.transform.prop]='translate3d(0px, 0px, 0px)'}this.o.style.width=k.flakeWidth+'px';this.o.style.height=k.flakeHeight+'px';this.o.style.fontFamily='arial,verdana';this.o.style.cursor='default';this.o.style.overflow='hidden';this.o.style.fontWeight='normal';this.o.style.zIndex=k.zIndex;docFrag.appendChild(this.o);this.refresh=function(){if(isNaN(s.x)||isNaN(s.y)){return false}k.setXY(s.o,s.x,s.y)};this.stick=function(){if(noFixed||(k.targetElement!==h.documentElement&&k.targetElement!==h.body)){s.o.style.top=(screenY+scrollY-k.flakeHeight)+'px'}else if(k.flakeBottom){s.o.style.top=k.flakeBottom+'px'}else{s.o.style.display='none';s.o.style.bottom='0%';s.o.style.position='fixed';s.o.style.display='block'}};this.vCheck=function(){if(s.vX>=0&&s.vX<0.2){s.vX=0.2}else if(s.vX<0&&s.vX>-0.2){s.vX=-0.2}if(s.vY>=0&&s.vY<0.2){s.vY=0.2}};this.move=function(){var a=s.vX*windOffset,yDiff;s.x+=a;s.y+=(s.vY*s.vAmp);if(s.x>=screenX||screenX-s.x<k.flakeWidth){s.x=0}else if(a<0&&s.x-k.flakeLeftOffset<-k.flakeWidth){s.x=screenX-k.flakeWidth-1}s.refresh();yDiff=screenY+scrollY-s.y+k.flakeHeight;if(yDiff<k.flakeHeight){s.active=0;if(k.snowStick){s.stick()}else{s.recycle()}}else{if(k.useMeltEffect&&s.active&&s.type<3&&!s.melting&&Math.random()>0.998){s.melting=true;s.melt()}if(k.useTwinkleEffect){if(s.twinkleFrame<0){if(Math.random()>0.97){s.twinkleFrame=parseInt(Math.random()*8,10)}}else{s.twinkleFrame--;if(!opacitySupported){s.o.style.visibility=(s.twinkleFrame&&s.twinkleFrame%2===0?'hidden':'visible')}else{s.o.style.opacity=(s.twinkleFrame&&s.twinkleFrame%2===0?0:1)}}}}};this.animate=function(){s.move()};this.setVelocities=function(){s.vX=vRndX+rnd(k.vMaxX*0.12,0.1);s.vY=vRndY+rnd(k.vMaxY*0.12,0.1)};this.setOpacity=function(o,a){if(!opacitySupported){return false}o.style.opacity=a};this.melt=function(){if(!k.useMeltEffect||!s.melting){s.recycle()}else{if(s.meltFrame<s.meltFrameCount){s.setOpacity(s.o,s.meltFrames[s.meltFrame]);s.o.style.fontSize=s.fontSize-(s.fontSize*(s.meltFrame/s.meltFrameCount))+'px';s.o.style.lineHeight=k.flakeHeight+2+(k.flakeHeight*0.75*(s.meltFrame/s.meltFrameCount))+'px';s.meltFrame++}else{s.recycle()}}};this.recycle=function(){s.o.style.display='none';s.o.style.position=(fixedForEverything?'fixed':'absolute');s.o.style.bottom='auto';s.setVelocities();s.vCheck();s.meltFrame=0;s.melting=false;s.setOpacity(s.o,1);s.o.style.padding='0px';s.o.style.margin='0px';s.o.style.fontSize=s.fontSize+'px';s.o.style.lineHeight=(k.flakeHeight+2)+'px';s.o.style.textAlign='center';s.o.style.verticalAlign='baseline';s.x=parseInt(rnd(screenX-k.flakeWidth-20),10);s.y=parseInt(rnd(screenY)*-1,10)-k.flakeHeight;s.refresh();s.o.style.display='block';s.active=1};this.recycle();this.refresh()};this.snow=function(){var a=0,flake=null,i,j;for(i=0,j=k.flakes.length;i<j;i++){if(k.flakes[i].active===1){k.flakes[i].move();a++}if(k.flakes[i].melting){k.flakes[i].melt()}}if(a<k.flakesMaxActive){flake=k.flakes[parseInt(rnd(k.flakes.length),10)];if(flake.active===0){flake.melting=true}}if(k.timer){features.getAnimationFrame(k.snow)}};this.mouseMove=function(e){if(!k.followMouse){return true}var x=parseInt(e.clientX,10);if(x<screenX2){windOffset=-windMultiplier+(x/screenX2*windMultiplier)}else{x-=screenX2;windOffset=(x/screenX2)*windMultiplier}};this.createSnow=function(a,b){var i;for(i=0;i<a;i++){k.flakes[k.flakes.length]=new k.SnowFlake(parseInt(rnd(flakeTypes),10));if(b||i>k.flakesMaxActive){k.flakes[k.flakes.length-1].active=-1}}k.targetElement.appendChild(docFrag)};this.timerInit=function(){k.timer=true;k.snow()};this.init=function(){var i;for(i=0;i<k.meltFrameCount;i++){k.meltFrames.push(1-(i/k.meltFrameCount))}k.randomizeWind();k.createSnow(k.flakesMax);k.events.add(g,'resize',k.resizeHandler);k.events.add(g,'scroll',k.scrollHandler);if(k.freezeOnBlur){if(isIE){k.events.add(h,'focusout',k.freeze);k.events.add(h,'focusin',k.resume)}else{k.events.add(g,'blur',k.freeze);k.events.add(g,'focus',k.resume)}}k.resizeHandler();k.scrollHandler();if(k.followMouse){k.events.add(isIE?h:g,'mousemove',k.mouseMove)}k.animationInterval=Math.max(20,k.animationInterval);k.timerInit()};this.start=function(a){if(!didInit){didInit=true}else if(a){return true}if(typeof k.targetElement==='string'){var b=k.targetElement;k.targetElement=h.getElementById(b);if(!k.targetElement){throw new Error('Snowstorm: Unable to get targetElement "'+b+'"');}}if(!k.targetElement){k.targetElement=(h.body||h.documentElement)}if(k.targetElement!==h.documentElement&&k.targetElement!==h.body){k.resizeHandler=k.resizeHandlerAlt;k.usePixelPosition=true}k.resizeHandler();k.usePositionFixed=(k.usePositionFixed&&!noFixed&&!k.flakeBottom);if(g.getComputedStyle){try{targetElementIsRelative=(g.getComputedStyle(k.targetElement,null).getPropertyValue('position')==='relative')}catch(e){targetElementIsRelative=false}}fixedForEverything=k.usePositionFixed;if(screenX&&screenY&&!k.disabled){k.init();k.active=true}};function doDelayedStart(){g.setTimeout(function(){k.start(true)},20);k.events.remove(isIE?h:g,'mousemove',doDelayedStart)}function doStart(){if(!k.excludeMobile||!isMobile){doDelayedStart()}k.events.remove(g,'load',doStart)}if(k.autoStart){k.events.add(g,'load',doStart,false)}return this}(window,document));